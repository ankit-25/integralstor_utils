import re
from integralstor_common import command, common

"""
Parse the ntp.conf file to determine the list of ntp servers.
"""
def get_ntp_servers():

    list = []
    try :
        ntp_conf_path, err = common.get_ntp_conf_path()
        if err:
            raise Exception(err)
        with open("%s/ntp.conf"%ntp_conf_path, "r") as f:
            lines = f.readlines()
            for line in lines:
                r1 = re.match("[\s]*server[\s]*([\S]+)", line)
                if r1:
                    r = r1.groups()
                    if len(r) > 0:
                        s = r[0]
                        if s and s != "127.0.0.1":
                            list.append(s)
    except Exception, e:
        return None, 'Error getting NTP server list : %s'%str(e)
    else:
        return list, None


# vim: tabstop=8 softtabstop=0 expandtab ai shiftwidth=4 smarttab
