from integralstor_common import common
from crontab import CronTab

"""
  function to create a cron job
  Parameters :
  0 Name of the cron job
  1 Minute 0-59
  2 Hour 0-23 (0 = midnight)
  3 Day 1-31
  4 Month 1-12
  5 Weekday 0-6 (0 = Sunday) 
  6 Command to be executed. do not pass >> logfile 2>&1. It will be autocreated with the cronjob name
"""
def create_cron(cron_name,min="1",hour='*',day='*',dow='*',month='*',command=None):
  cron = CronTab(user='root')
  job  = cron.new(command=command,comment=cron_name)
  job.setall(min,hour,day,dow,month)
  if job.is_valid():
    job.enable()
    cron.write()
  else:
    return False
  return True;

def list_cron():
  cron = CronTab(user='root')
  for job in cron:
    print job

def find_cron(name):
  cron = CronTab(user='root')
  try:
    job = None
    del(job)
    job = cron.find_comment(name)
    return job
  except Exception,e:
    return e

def delete_cron_with_comment(name):
  cron = CronTab(user='root')
  try:
    cron.remove_all(comment=comment)
    cron.write()
    return True
  except Exception, e:
    return e
"""
  for job in cron:
    if job.comment == comment:
      cron.remove(job)
      cron.write()
      return True
    else:
      return False
"""
def main():
  print create_cron("test",1,'*','*','*','*',command="/bin/echo 'Hello World' >> /tmp/hello.log 2>&1")
  #list_cron()
  #print delete_cron_with_comment("test")
  cron = None
  cron =  find_cron("test")
  for param in cron:
    print param.command

if __name__ == "__main__":
  main()
