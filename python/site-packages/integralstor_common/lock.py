import os, sys

def get_lock(name):
  ret = False
  try:
    pid = str(os.getpid())
    pidfile = '/tmp/integralstor_%s_lock.pid'%name
    if os.path.isfile(pidfile):
      ret =  False
    else:
      file(pidfile, 'w').write(pid)
      ret = True
  except Exception, e:
    return False, 'Error getting lock : %s'%str(e)
  else:
    return ret, None

def release_lock(name):
  try:
    pidfile = '/tmp/integralstor_%s_lock.pid'%name
    try:
      os.unlink(pidfile)
    except Exception, e:
      pass
  except Exception, e:
    return False, 'Error releasing lock : %s'%str(e)
  else:
    return True, None
